



fragment PortfolioSummary on Portfolio {
  _id
  cash
  owner {
    ...FullUser
  }
  name
  description
  private
  totalValue
}

fragment PortfolioPositions on Portfolio {
  positions {
    ...AllPositionData
  }
}

fragment AllPortfolioData on Portfolio {
  ...PortfolioSummary
  ...PortfolioPositions

  plaid {
    access_token
    item_id
    isLinked
  }
}

fragment AllPositionData on Position {
      _id
      # Market data fields
      marketValue
      exposure
      profitLossUsd
      profitLossPercent
      dailyProfitLossUsd
      #

      direction
      averagePrice
      costBasis
      brokerFees
      positionSize
      positionType
      openDate
      closeDate
      symbol {
        name
        symbol
        symbolType
        exchange
        region
        currency
        quote {
          avgTotalVolume
          calculationPrice
          change
          changePercent
          companyName
          close
          closeSource
          closeTime
          currency
          delayedPrice
          delayedPriceTime
          extendedPrice
          extendedChange
          extendedChangePercent
          extendedPriceTime
          high
          highSource
          highTime
          iexAskPrice
          iexAskSize
          iexBidPrice
          iexBidSize
          iexClose
          iexCloseTime
          iexLastUpdated
          iexOpen
          iexOpenTime
          iexRealtimePrice
          iexRealtimeSize
          iexMarketPercent
          iexVolume
          isUSMarketOpen
          lastTradeTime
          latestPrice
          latestSource
          latestTime
          latestUpdate
          latestVolume
          low
          lowTime
          lowSource
          marketCap
          oddLotDelayedPrice
          oddLotDelayedPriceTime
          open
          openSource
          openTime
          peRatio
          previousClose
          previousVolume
          primaryExchange
          symbol
          week52High
          week52Low
          volume
          ytdChange
        }
      }
}

fragment FullUser on User {
	_id
	displayName
	emails
	photos
}

mutation addPosition($record: AddPositionInput!, $portfolioId: ObjectId!) {
  addPosition(id: $portfolioId, record: $record) {
    recordId
  }
}

mutation createPortfolio {
  createPortfolio {
    record {
      _id
      ...AllPortfolioData
    }
  }
}

mutation deletePortfolio($id: ObjectId!) {
  deletePortfolio(_id: $id) {
    recordId
  }
}

mutation findOrCreateUser($record: FindOrCreateUserInput!){
  findOrCreateUser(record: $record) {
    record {
	    _id
	    ...FullUser
    }
  }
}

mutation portfolioCreateLinkToken($portfolioId: ObjectId!) {
  portfolioCreateLinkToken(portfolio_id: $portfolioId) {
    link_token
    expiration
    request_id
  }
}

mutation portfolioLinkBroker($input: LinkBrokerInput!, $portfolioId: ObjectId!) {
  portfolioLinkBroker(input: $input, portfolio_id: $portfolioId) {
    recordId
  }
}

mutation removePosition($portfolio_id: ObjectId!, $position_id: ObjectId!) {
  removePosition(portfolio_id: $portfolio_id, position_id: $position_id) {
    recordId
  }
}

mutation updatePortfolio($input: UpdatePortfolioInput!, $id: ObjectId!) {
  updatePortfolio(input: $input, _id: $id) {
    record {
      _id
    }
  }
}


query myPortfoliosSummary {
  myPortfolios {
    ...PortfolioSummary
  }
}

query portfolio($id: ObjectId!) {
  portfolio(portfolioId: $id) {
    _id
    ...AllPortfolioData
  }
}

query searchSymbols($search: String!) {
  searchSymbols(search: $search){
    symbol
    _id
    name
    exchange
    exchangeName
    region
    symbolType
    currency
    quote {
      latestTime
      latestPrice
    }
  }
}
